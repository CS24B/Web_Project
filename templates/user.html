<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>Webapp</title>
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="shortcut icon" type="image/ico" href="../static/img/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>

      var table_students = [];
      var table_teachers = [];
      var content = "";
      var tab = 0;
      var modal;
      var last_click = -1;
      var last_click_data = -1;
      var edit_row;
      var disabled_keys = [];
      var modal_vis = false;
      var active_add = 0;
      var active_search = 0;
      var db_tables = ["Student", "Teacher", "Class", "Course", "CCA", "StudentCourse", "StudentCCA", "TeacherCourse", "CourseSession", "CCASession"]

      function change_content(val) {
        content = val;
      }

      function change_tab(val) {
        tab = val;
      }
      
      function disable_keys(...keys) {
        disabled_keys = keys;
      }

      function intersect(...arrs) {
        arrs = arrs.filter(arr => arr.length);
        for (let i = 1; i < arrs.length; i++) {
          arrs[0] = arrs[0].filter(value => JSON.stringify(arrs[i]).indexOf(JSON.stringify(value)) !== -1);
        }
        return arrs[0];
      }

      async function get_data(cmd, db="School") {
        const response = await fetch(`/getdata?db=${encodeURIComponent(db)}&cmd=${encodeURIComponent(cmd)}`);
        const json = await response.json();
        return json;
      }

      function post_data(cmd, db="School") {
        fetch(`/postdata?db=${encodeURIComponent(db)}&cmd=${encodeURIComponent(cmd)}`, {method: "POST"});
      }

      async function add_students() {
        var student_name = document.getElementById("student_name_s").value;
        var class_name = document.getElementById("class_name_s").value;
        var course_name = document.getElementById("course_name_s").value;
        var teacher_name = document.getElementById("teacher_name_s").value;
        var cca_name = document.getElementById("cca_name_s").value;
        var container = document.getElementById("student_data");
        
        var students = await get_data(`SELECT ID FROM Student WHERE Name = '${student_name}'`);
        var students_class = await get_data(`SELECT ID FROM Student WHERE ClassID IN (SELECT ID FROM Class WHERE Name = '${class_name}')`);
        var students_course = await get_data(`SELECT ID FROM Student WHERE ID IN (SELECT StudentID FROM StudentCourse WHERE CourseID IN (SELECT ID FROM Course WHERE Name = '${course_name}'))`);
        var students_teacher = await get_data(`SELECT ID FROM Student WHERE ID IN (SELECT StudentID FROM StudentCourse WHERE CourseID IN (SELECT CourseID FROM TeacherCourse WHERE CourseID > 28 AND CourseID < 249 AND TeacherID IN (SELECT ID FROM Teacher WHERE Name = '${teacher_name}')))`);
        var students_cca = await get_data(`SELECT ID FROM Student WHERE ID IN (SELECT StudentID FROM StudentCCA WHERE CCAID IN (SELECT ID FROM CCA WHERE Name = '${cca_name}'))`);
        if (students.length === 0 && students_class.length === 0 && students_course.length === 0 && students_teacher.length === 0 && students_cca.length === 0) { return false; }
        students = intersect(students, students_class, students_course, students_teacher, students_cca);
        
        var table = document.getElementById("student_table");
        var student_data = await get_data(`SELECT Student.ID, Student.Name, Class.Name FROM Student INNER JOIN Class ON ClassID = Class.ID WHERE Student.ID IN (${"'" + students.join("','") + "'"})`);
        
        var row;
        var cell;
        var img;
        var input;
        for (let i = 0; i < students.length; i++) {
          if (!(table_students.includes(students[i]))) {
            input = document.createElement("input");
            input.type = "hidden";
            input.name = "st";
            input.setAttribute("value", student_data[i][0]);
            container.appendChild(input);
            table_students.push(students[i]);
            row = table.insertRow(-1);
            row.classList.add("table_data_row");
            for (let j = 0; j < 3; j++) {
              cell = row.insertCell(-1);
              cell.innerText = student_data[i][j];
            }
            cell = row.insertCell(-1);
            img = document.createElement("img");
            img.src = "../static/img/delete.png";
            img.alt = "delete";
            img.className = "select_icon";
            img.onclick = function() {
              data_row = this.parentElement.parentElement;
              table_students.pop(table_students.indexOf(data_row.getElementsByTagName("td")[0].innerText));
              data_row.remove();
            }
            cell.appendChild(img);
          }
        }
      }

      function clear_students() {
        var rows = document.getElementById("student_table").getElementsByClassName("table_data_row");
        var container = document.getElementById("student_data");
        while (rows.length > 0) {
          rows[0].remove();
        }
        table_students = [];
        document.getElementById("student_name_s").value = "";
        document.getElementById("class_name_s").value = "";
        document.getElementById("course_name_s").value = "";
        document.getElementById("teacher_name_s").value = "";
        document.getElementById("cca_name_s").value = "";
        while (container.hasChildNodes()) {
          container.removeChild(container.lastChild);
        }
      }

      async function add_teachers() {
        var teacher_name = document.getElementById("teacher_name_t").value;
        var class_name = document.getElementById("class_name_t").value;
        var course_name = document.getElementById("course_name_t").value;
        var student_name = document.getElementById("student_name_t").value;
        var container = document.getElementById("teacher_data");
        
        var teachers = await get_data(`SELECT ID FROM Teacher WHERE Name = '${teacher_name}'`);
        var teachers_class = await get_data(`SELECT ID FROM Teacher WHERE ClassID IN (SELECT ID FROM Class WHERE Name = '${class_name}')`);
        var teachers_course = await get_data(`SELECT ID FROM Teacher WHERE ID IN (SELECT TeacherID FROM TeacherCourse WHERE CourseID IN (SELECT ID FROM Course WHERE Name = '${course_name}'))`);
        var teachers_student = await get_data(`SELECT ID FROM Teacher WHERE ID IN (SELECT TeacherID FROM TeacherCourse WHERE CourseID IN (SELECT CourseID FROM StudentCourse WHERE CourseID > 28 AND CourseID < 249 AND StudentID IN (SELECT ID FROM Student WHERE Name = '${student_name}')))`);
        if (teachers.length === 0 && teachers_class.length === 0 && teachers_course.length === 0 && teachers_student.length === 0) { return false; }
        teachers = intersect(teachers, teachers_class, teachers_course, teachers_student);
        
        var table = document.getElementById("teacher_table");
        var teacher_data = await get_data(`SELECT ID, Name FROM Teacher WHERE ID IN (${"'" + teachers.join("','") + "'"})`);
        
        var row;
        var cell;
        var img;
        var input;
        for (let i = 0; i < teacher_data.length; i++) {
          if (!(table_teachers.includes(teacher_data[i][0]))) {
            input = document.createElement("input");
            input.type = "hidden";
            input.name = "tc";
            input.setAttribute("value", teacher_data[i][0]);
            container.appendChild(input);
            table_teachers.push(teacher_data[i][0]);
            row = table.insertRow(-1);
            row.classList.add("table_data_row");
            for (let j = 0; j < 2; j++) {
              cell = row.insertCell(-1);
              cell.innerText = teacher_data[i][j];
            }
            cell = row.insertCell(-1);
            img = document.createElement("img");
            img.src = "../static/img/delete.png";
            img.alt = "delete";
            img.className = "select_icon";
            img.onclick = function() {
              data_row = this.parentElement.parentElement;
              table_teachers.pop(table_teachers.indexOf(data_row.getElementsByTagName("td")[0].innerText));
              data_row.remove();
            }
            cell.appendChild(img);
          }
        }
      }

      function clear_teachers() {
        var rows = document.getElementById("teacher_table").getElementsByClassName("table_data_row");
        var container = document.getElementById("teacher_data");
        while (rows.length > 0) {
          rows[0].remove();
        }
        table_teachers = [];
        document.getElementById("teacher_name_t").value = "";
        document.getElementById("class_name_t").value = "";
        document.getElementById("course_name_t").value = "";
        document.getElementById("student_name_t").value = "";
        while (container.hasChildNodes()) {
          container.removeChild(container.lastChild);
        }
      }

      function del_checked(e, element) {
        var input_elements = document.getElementsByTagName("input");
        document.getElementById("account_del").style.visibility = "hidden";
        for (let i = 0; i < input_elements.length; i++) {
          if (input_elements[i].className === "check_del") {
            if (input_elements[i].checked) {
              document.getElementById("account_del").style.visibility = "visible";
              break;
            }
          }
        }
        if (element) {
          var table = element.parentNode.parentNode.parentNode;
          var row_index = [...table.children].indexOf(element.parentNode.parentNode);
          if (last_click !== -1) {
            if (last_click !== row_index && table.children[last_click].children[0].children[0].checked && element.checked) {
              if (e.shiftKey) {
                for (let i = Math.min(last_click, row_index) + 1; i < Math.max(last_click, row_index); i++) {
                  if (table.children[i].children[0].children.length) {
                    table.children[i].children[0].children[0].checked = true;
                  }
                }
              }
            }
          }
          if (element.checked === true) {
            last_click = row_index;
          }
        }
      }

      function data_del_check(e, element) {
        var table = document.getElementsByClassName("search_group_table")[active_search];
        var rows = table.getElementsByClassName("table_data_row");
        var checks = Array.from(rows).map(x => x.children[0].children[0]);

        if (checks.some(x => x.checked)) {
          table.getElementsByClassName("scroll_head")[0].children[0].children[0].style.visibility = "visible";
        } else {
          table.getElementsByClassName("scroll_head")[0].children[0].children[0].style.visibility = "hidden";
        }

        if (element) {
          var table = element.parentNode.parentNode.parentNode;
          var row_index = [...table.children].indexOf(element.parentNode.parentNode);
          if (last_click_data !== -1) {
            if (last_click_data !== row_index && table.children[last_click_data].children[0].children[0].checked && element.checked) {
              if (e.shiftKey) {
                for (let i = Math.min(last_click_data, row_index) + 1; i < Math.max(last_click_data, row_index); i++) {
                  if (table.children[i].children[0].children.length) {
                    table.children[i].children[0].children[0].checked = true;
                  }
                }
              }
            }
          }
          if (element.checked === true) {
            last_click_data = row_index;
          }
        }
      }

      function delete_account_modal() {
        modal = new bootstrap.Modal(document.getElementById("delete_account_modal"));
        modal.show();
      }

      function delete_accounts() {
        if (tab === 3) {
          var rows = document.getElementById("account_table").children[0].children;
          var cell;
          for (let i = rows.length - 1; i > 0; i--) {
            cell = rows[i].children[0]
            if (cell.children.length) {
              if (cell.children[0].checked) {
                rows[i].remove();
              }
            }
          }
        }
        del_checked();
        modal.hide();
      }

      function edit_account_modal(element) {
        var row = element.parentNode.parentNode;
        var uname = row.children[1].innerText;
        var pwd = row.children[2].innerText;
        var unames = Array.from(row.parentNode.children).map(x => x.children[1].innerText).splice(1);
        edit_row = unames.indexOf(uname);
        modal = new bootstrap.Modal(document.getElementById("edit_account_modal"));
        document.getElementById("edit_account_modal").getElementsByClassName("form-control")[0].setAttribute("value", uname);
        document.getElementById("edit_account_modal").getElementsByClassName("form-control")[1].setAttribute("value", pwd);
        modal.show();
      }

      function check_edit_account() {
        var rows = document.getElementById("account_table").getElementsByClassName("table_data_row");
        var unames = Array.from(rows).map(x => x.children[1].innerText);
        var data = document.getElementById("edit_account_modal").getElementsByClassName("form-control");
        var index = unames.indexOf(data[0].value);
        document.getElementById("edit_account_modal").getElementsByClassName("btn-primary")[0].disabled = false;
        if (index >= 0 && index !== edit_row) {
          document.getElementById("edit_account_modal").getElementsByClassName("btn btn-primary")[0].disabled = true;
        }
        if (data[0].value === "" || data[1].value === "") {
          document.getElementById("edit_account_modal").getElementsByClassName("btn btn-primary")[0].disabled = true;
        }
      }

      function edit_account() {
        var data = document.getElementById("edit_account_modal").getElementsByClassName("form-control");
        var row = document.getElementById("account_table").getElementsByClassName("table_data_row")[edit_row];
        row.children[1].innerText = data[0].value;
        row.children[2].innerText = data[1].value;
        modal.hide();
      }

      function add_account_modal() {
        modal = new bootstrap.Modal(document.getElementById("add_account_modal"));
        modal.show();
      }

      async function check_add_account() {
        var inputs = document.getElementById("add_account_modal").getElementsByClassName("form-control");
        var accs = await get_data("SELECT Username FROM Account", "Account");

        document.getElementById("add_account_modal").getElementsByClassName("btn-primary")[0].disabled = false;
        if (inputs[0].value === "" || inputs[1].value === "") {
          document.getElementById("add_account_modal").getElementsByClassName("btn-primary")[0].disabled = true;
        }
        if (accs.map(x => x[0]).includes(inputs[0].value)) {
          document.getElementById("add_account_modal").getElementsByClassName("btn-primary")[0].disabled = true;
        }
      }

      function add_account(val) {
        table = document.getElementById("account_table");
        if (Array.from(table.children[0].getElementsByClassName("table_data_row")).map(x => x.children[1].innerText).includes(val[0].value)) {
          return false;
        }
        var row = table.insertRow(-1);
        row.className = "table_data_row";
        var cell = row.insertCell(-1);
        cell.style.textAlign = "center";
        cell.style.width = "150px";
        var checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.className = "check_del";
        checkbox.style = "transform: scale(1.5);";
        checkbox.setAttribute("onclick", "del_checked(event, this)");
        cell.appendChild(checkbox);
        cell = row.insertCell(-1);
        cell.innerText = val[0].value;
        cell = row.insertCell(-1);
        cell.innerText = val[1].value;
        cell = row.insertCell(-1);
        cell.innerText = "1";
        cell = row.insertCell(-1);
        var img = document.createElement("img");
        img.src = "../static/img/edit.png";
        img.alt = "edit";
        img.className = "select_icon";
        img.setAttribute("onclick", "edit_account_modal(this)");
        cell.appendChild(img);
        modal.hide();
      }

      function save_account_modal() {
        modal = new bootstrap.Modal(document.getElementById("save_account_modal"));
        modal.show();
      }

      async function save_accounts() {
        var rows = document.getElementById("account_table").getElementsByClassName("table_data_row");
        var accounts = Array.from(rows).map(x => [x.children[1].innerText, x.children[2].innerText, x.children[3].innerText]);
        await post_data("DELETE FROM Account", "Account");
        for (let i = 0; i < accounts.length; i++) {
          post_data(`INSERT INTO Account VALUES ('${accounts[i][0]}', '${accounts[i][1]}', ${parseInt(accounts[i][2])})`, "Account");
        }
        modal.hide();
      }

      function delete_data_modal() {
        modal = new bootstrap.Modal(document.getElementById("delete_data_modal"));
        modal.show();
      }

      function delete_data() {
        var table = document.getElementsByClassName("search_group_table")[active_search];
        var rows = table.getElementsByClassName("table_data_row");
        
        for (let i = rows.length - 1; i >= 0; i--) {
          if (rows[i].children[0].children[0].checked) {
            if (active_search >= 0 && active_search <= 4) {
              post_data(`DELETE FROM ${db_tables[active_search]} WHERE ID = '${rows[i].children[1].innerText}'`);
            } else if (active_search === 5) {
              post_data(`DELETE FROM StudentCourse WHERE StudentID = '${rows[i].children[1].innerText}' AND CourseID = ${rows[i].children[2].innerText}`);
            } else if (active_search === 6) {
              post_data(`DELETE FROM StudentCCA WHERE StudentID = '${rows[i].children[1].innerText}' AND CCAID = ${rows[i].children[2].innerText}`);
            } else if (active_search === 7) {
              post_data(`DELETE FROM TeacherCourse WHERE TeacherID = '${rows[i].children[1].innerText}' AND CourseID = ${rows[i].children[2].innerText}`);
            } else if (active_search === 8) {
              post_data(`DELETE FROM CourseSession WHERE CourseID = ${rows[i].children[1].innerText} AND Day = '${rows[i].children[2].innerText}' AND StartTime = '${rows[i].children[3].innerText}'`);
            } else {
              post_data(`DELETE FROM CCASession WHERE CCAID = ${rows[i].children[1].innerText} AND Day = '${rows[i].children[2].innerText}' AND StartTime = '${rows[i].children[3].innerText}'`);
            }
            rows[i].remove();
          }
        }
        modal.hide();
        table.getElementsByClassName("scroll_head")[0].children[0].children[0].style.visibility = "hidden";
      }

      function backup(db="School") {
        fetch(`/backup?db=${db}`, {method: "POST"});
        location.reload();
      }

      function check_add_table(element) {
        var add_group = document.getElementsByClassName("add_group");

        for (let i = 0; i < 10; i++) {
          add_group[i].hidden = true;
        }
        if (element.value.toUpperCase() === "STUDENT") {
          add_group[0].hidden = false;
          active_add = 0;
        } else if (element.value.toUpperCase() === "TEACHER") {
          add_group[1].hidden = false;
          active_add = 1;
        } else if (element.value.toUpperCase() === "CLASS") {
          add_group[2].hidden = false;
          active_add = 2;
        } else if (element.value.toUpperCase() === "COURSE") {
          add_group[3].hidden = false;
          active_add = 3;
        } else if (element.value.toUpperCase() === "CCA") {
          add_group[4].hidden = false;
          active_add = 4;
        } else if (element.value.toUpperCase() === "STUDENTCOURSE") {
          add_group[5].hidden = false;
          active_add = 5;
        } else if (element.value.toUpperCase() === "STUDENTCCA") {
          add_group[6].hidden = false;
          active_add = 6;
        } else if (element.value.toUpperCase() === "TEACHERCOURSE") {
          add_group[7].hidden = false;
          active_add = 7;
        } else if (element.value.toUpperCase() === "COURSESESSION") {
          add_group[8].hidden = false;
          active_add = 8;
        } else if (element.value.toUpperCase() === "CCASESSION") {
          add_group[9].hidden = false;
          active_add = 9;
        }
        check_add();
      }

      function check_search_table(element) {
        var search_group = document.getElementsByClassName("search_group");

        for (let i = 0; i < 10; i++) {
          search_group[i].hidden = true;
        }
        if (element.value.toUpperCase() === "STUDENT") {
          search_group[0].hidden = false;
          active_search = 0;
        } else if (element.value.toUpperCase() === "TEACHER") {
          search_group[1].hidden = false;
          active_search = 1;
        } else if (element.value.toUpperCase() === "CLASS") {
          search_group[2].hidden = false;
          active_search = 2;
        } else if (element.value.toUpperCase() === "COURSE") {
          search_group[3].hidden = false;
          active_search = 3;
        } else if (element.value.toUpperCase() === "CCA") {
          search_group[4].hidden = false;
          active_search = 4;
        } else if (element.value.toUpperCase() === "STUDENTCOURSE") {
          search_group[5].hidden = false;
          active_search = 5;
        } else if (element.value.toUpperCase() === "STUDENTCCA") {
          search_group[6].hidden = false;
          active_search = 6;
        } else if (element.value.toUpperCase() === "TEACHERCOURSE") {
          search_group[7].hidden = false;
          active_search = 7;
        } else if (element.value.toUpperCase() === "COURSESESSION") {
          search_group[8].hidden = false;
          active_search = 8;
        } else if (element.value.toUpperCase() === "CCASESSION") {
          search_group[9].hidden = false;
          active_search = 9;
        }
        // check_search();
      }

      async function check_add() {
        var sibs = document.getElementById("add_data_form").children[active_add + 1].children;
        var students = Array.from(document.getElementById("student_list_id").children).map(x => x.value);
        var teachers = Array.from(document.getElementById("teacher_list_id").children).map(x => x.value);
        var classes = Array.from(document.getElementById("class_list_id").children).map(x => x.value);
        var courses = Array.from(document.getElementById("course_list_id").children).map(x => x.value);
        var ccas = Array.from(document.getElementById("cca_list_id").children).map(x => x.value);
        var add_button = document.getElementById("record_add");
        var regex=/^[0-9]+$/;
        
        add_button.disabled = false;
        if (active_add === 0) {
          if (!(classes.includes(sibs[2].value) && await check_ic(sibs[0].value))) {
            add_button.disabled = true;
          }
        } else if (active_add === 1) {
          if (!((classes.includes(sibs[2].value) || sibs[2].value === "None") && await check_ic(sibs[0].value))) {
            add_button.disabled = true;
          }
        } else if (active_add === 5) {
          if (!(students.includes(sibs[0].value) && courses.includes(sibs[1].value))) {
            add_button.disabled = true;
          }
        } else if (active_add === 6) {
          if (!(students.includes(sibs[0].value) && ccas.includes(sibs[1].value))) {
            add_button.disabled = true;
          }
        } else if (active_add === 7) {
          if (!(teachers.includes(sibs[0].value) && courses.includes(sibs[1].value))) {
            add_button.disabled = true;
          }
        } else if (active_add === 8 || active_add === 9) {
          if (!(
            (courses.includes(sibs[0].value) && active_add === 8 || ccas.includes(sibs[0].value) && active_add === 9)
            && sibs[2].value.match(regex) && sibs[2].value <= 1900 && sibs[2].value >= 800 &&
            [0, 10, 20, 30, 40, 50].includes(sibs[2].value % 100) && sibs[3].value.match(regex) && sibs[3].value <= 1900
            && sibs[3].value >= 800 && [0, 10, 20, 30, 40, 50].includes(sibs[3].value % 100) && parseInt(sibs[2].value) < parseInt(sibs[3].value)
          )) {
            add_button.disabled = true;
          }
        }
        for (let i = 0; i < sibs.length; i++) {
          if (sibs[i].value === "") {
            add_button.disabled = true;
          }
        }
      }

      async function check_ic(ic) {
        var tot;
        var check;
        var ics = (await get_data("SELECT ID FROM Student")).concat(await get_data("SELECT ID FROM Teacher")).map(x => x[0]);
        
        if (ic.length !== 9) {
          return false;
        }
        if (ic[0].toUpperCase() === "S" && (ic.slice(1,3) >= 68 && ic.slice(1,3) <= 99 || ic[1] == 0 || ic[1] == 1)) {
          tot = ic[1]*2 + ic[2]*7 + ic[3]*6 + ic[4]*5 + ic[5]*4 + ic[6]*3 + ic[7]*2
          check = ["J", "Z", "I", "H", "G", "F", "E", "D", "C", "B", "A"]
        } else if (ic[0].toUpperCase() === "F") {
          tot = ic[1]*2 + ic[2]*7 + ic[3]*6 + ic[4]*5 + ic[5]*4 + ic[6]*3 + ic[7]*2
          check = ["X", "W", "U", "T", "R", "Q", "P", "N", "M", "L", "K"]
        } else if (ic[0].toUpperCase() === "T" && ic.slice(1,3) >= 0) {
          tot = ic[1]*2 + ic[2]*7 + ic[3]*6 + ic[4]*5 + ic[5]*4 + ic[6]*3 + ic[7]*2 + 4
          check = ["J", "Z", "I", "H", "G", "F", "E", "D", "C", "B", "A"]
        } else if (ic[0].toUpperCase() === "G") {
          tot = ic[1]*2 + ic[2]*7 + ic[3]*6 + ic[4]*5 + ic[5]*4 + ic[6]*3 + ic[7]*2 + 4
          check = ["X", "W", "U", "T", "R", "Q", "P", "N", "M", "L", "K"]
        } else {
          return false;
        }
        if (ic[8].toUpperCase() !== check[tot % 11]) {
          return false;
        }
        if (ics.includes(ic.toUpperCase())) {
          return false;
        }
        return true;
      }

      function check_ic_2(ic) {
        var tot;
        var check;
        
        if (ic.length !== 9) {
          return false;
        }
        if (ic[0].toUpperCase() === "S" && (ic.slice(1,3) >= 68 && ic.slice(1,3) <= 99 || ic[1] == 0 || ic[1] == 1)) {
          tot = ic[1]*2 + ic[2]*7 + ic[3]*6 + ic[4]*5 + ic[5]*4 + ic[6]*3 + ic[7]*2
          check = ["J", "Z", "I", "H", "G", "F", "E", "D", "C", "B", "A"]
        } else if (ic[0].toUpperCase() === "F") {
          tot = ic[1]*2 + ic[2]*7 + ic[3]*6 + ic[4]*5 + ic[5]*4 + ic[6]*3 + ic[7]*2
          check = ["X", "W", "U", "T", "R", "Q", "P", "N", "M", "L", "K"]
        } else if (ic[0].toUpperCase() === "T" && ic.slice(1,3) >= 0) {
          tot = ic[1]*2 + ic[2]*7 + ic[3]*6 + ic[4]*5 + ic[5]*4 + ic[6]*3 + ic[7]*2 + 4
          check = ["J", "Z", "I", "H", "G", "F", "E", "D", "C", "B", "A"]
        } else if (ic[0].toUpperCase() === "G") {
          tot = ic[1]*2 + ic[2]*7 + ic[3]*6 + ic[4]*5 + ic[5]*4 + ic[6]*3 + ic[7]*2 + 4
          check = ["X", "W", "U", "T", "R", "Q", "P", "N", "M", "L", "K"]
        } else {
          return false;
        }
        if (ic[8].toUpperCase() !== check[tot % 11]) {
          return false;
        }
        return true;
      }

      function edit_data_modal(element) {
        var row = element.parentNode.parentNode;
        var data = Array.from(row.children).splice(1, row.children.length - 2).map(x => x.innerText);
        var records = Array.from(row.parentNode.children).splice(1).map(x => Array.from(x.children).map(y => y.innerText).splice(1, x.children.length - 2));
        var mod_bod = document.getElementById("edit_data_modal").getElementsByClassName("modal-body")[0];
        var inputs = mod_bod.children;
        var input;
        while (inputs.length > 0) {
          inputs[0].remove();
        }
        for (let i = 0; i < records.length; i++) {
          if (JSON.stringify(records[i]) === JSON.stringify(data)) {
            edit_row = i;
          }
        }
        modal = new bootstrap.Modal(document.getElementById("edit_data_modal"));
        for (let i = 0; i < data.length; i++) {
          input = document.createElement("input");
          input.className = "form-control";
          input.setAttribute("value", data[i]);
          input.setAttribute("onchange", "check_edit_data()");
          mod_bod.appendChild(input);
        }
        modal.show();
      }

      async function check_edit_data() {
        var rows = document.getElementsByClassName("search_group_table")[active_search].getElementsByClassName("table_data_row");
        var table_ids;
        var table_ids2;
        var table_ids3;
        var ids;
        var ids2;
        var data = document.getElementById("edit_data_modal").getElementsByClassName("form-control");
        var classes = Array.from(document.getElementById("class_list_id").children).map(x => x.value);
        var regex=/^[0-9]+$/;
        classes.push("");

        document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = false;
        if ([0, 1, 2, 3, 4].includes(active_search)) {
          table_ids = Array.from(rows).map(x => x.children[1].innerText);
          ids = await get_data(`SELECT ID FROM ${db_tables[active_search]}`);
          if (ids.map(x => x[0].toString()).includes(data[0].value) && table_ids[edit_row] !== data[0].value) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          if ([2, 3, 4].includes(active_search) && !(Number.isInteger(parseFloat(data[0].value)) && parseInt(data[0].value) > 0)) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          if (data[0].value === "" || data[1].value === "" || (active_search === 0 && data[2].value === "")) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          if ([0, 1].includes(active_search) && !((await check_ic(data[0].value) || table_ids[edit_row] === data[0].value) && classes.includes(data[2].value))) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
        } else if (active_search === 5) {
          table_ids = Array.from(rows).map(x => x.children[1].innerText);
          table_ids2 = Array.from(rows).map(x => x.children[2].innerText);
          ids = await get_data(`SELECT * FROM StudentCourse`);
          if (ids.filter(x => x[0] === data[0].value).map(x => x[1].toString()).includes(data[1].value) && (table_ids[edit_row] !== data[0].value || table_ids2[edit_row] !== data[1].value)) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          if (!(check_ic_2(data[0].value))) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          if (data[0].value === "" || data[1].value === "") {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          ids = await get_data(`SELECT ID FROM Student`);
          ids2 = await get_data(`SELECT ID FROM Course`);
          if (!(ids.map(x => x[0]).includes(data[0].value) && ids2.map(x => x[0]).includes(parseInt(data[1].value)))) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
        } else if (active_search === 6) {
          table_ids = Array.from(rows).map(x => x.children[1].innerText);
          table_ids2 = Array.from(rows).map(x => x.children[2].innerText);
          ids = await get_data(`SELECT * FROM StudentCCA`);
          if (ids.filter(x => x[0] === data[0].value).map(x => x[1].toString()).includes(data[1].value) && (table_ids[edit_row] !== data[0].value || table_ids2[edit_row] !== data[1].value)) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          if (!(check_ic_2(data[0].value))) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          if (data[0].value === "" || data[1].value === "") {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          ids = await get_data(`SELECT ID FROM Student`);
          ids2 = await get_data(`SELECT ID FROM CCA`);
          if (!(ids.map(x => x[0]).includes(data[0].value) && ids2.map(x => x[0]).includes(parseInt(data[1].value)))) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
        } else if (active_search === 7) {
          table_ids = Array.from(rows).map(x => x.children[1].innerText);
          table_ids2 = Array.from(rows).map(x => x.children[2].innerText);
          ids = await get_data(`SELECT * FROM TeacherCourse`);
          if (ids.filter(x => x[0] === data[0].value).map(x => x[1].toString()).includes(data[1].value) && (table_ids[edit_row] !== data[0].value || table_ids2[edit_row] !== data[1].value)) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          if (!(check_ic_2(data[0].value))) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          if (data[0].value === "" || data[1].value === "") {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          ids = await get_data(`SELECT ID FROM Teacher`);
          ids2 = await get_data(`SELECT ID FROM Course`);
          if (!(ids.map(x => x[0]).includes(data[0].value) && ids2.map(x => x[0]).includes(parseInt(data[1].value)))) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
        } else if (active_search === 8) {
          table_ids = Array.from(rows).map(x => x.children[1].innerText);
          table_ids2 = Array.from(rows).map(x => x.children[2].innerText);
          table_ids3 = Array.from(rows).map(x => x.children[3].innerText);
          ids = await get_data(`SELECT * FROM CourseSession`);
          if (ids.filter(x => x[0] === parseInt(data[0].value)).filter(x => x[1] === data[1].value).filter(x => parseInt(x[2]) === parseInt(data[2].value)).length > 0 && (table_ids[edit_row] !== data[0].value || table_ids2[edit_row] !== data[1].value || table_ids3[edit_row] !== data[2].value)) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          if (!(
            data[2].value.match(regex) && data[2].value <= 1900 && data[2].value >= 800 && [0, 10, 20, 30, 40, 50].includes(data[2].value % 100)
            && data[3].value.match(regex) && data[3].value <= 1900 && data[3].value >= 800 && [0, 10, 20, 30, 40, 50].includes(data[3].value % 100)
            && parseInt(data[2].value) < parseInt(data[3].value)
          )) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          if (data[0].value === "" || data[1].value === "" || data[2].value === "" || data[3].value === "") {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          ids = await get_data(`SELECT ID FROM Course`);
          if (!(ids.map(x => x[0]).includes(parseInt(data[0].value)) && ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"].includes(data[1].value))) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
        } else {
          table_ids = Array.from(rows).map(x => x.children[1].innerText);
          table_ids2 = Array.from(rows).map(x => x.children[2].innerText);
          table_ids3 = Array.from(rows).map(x => x.children[3].innerText);
          ids = await get_data(`SELECT * FROM CCASession`);
          if (ids.filter(x => x[0] === parseInt(data[0].value)).filter(x => x[1] === data[1].value).filter(x => parseInt(x[2]) === parseInt(data[2].value)).length > 0 && (table_ids[edit_row] !== data[0].value || table_ids2[edit_row] !== data[1].value || table_ids3[edit_row] !== data[2].value)) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          if (!(
            data[2].value.match(regex) && data[2].value <= 1900 && data[2].value >= 800 && [0, 10, 20, 30, 40, 50].includes(data[2].value % 100)
            && data[3].value.match(regex) && data[3].value <= 1900 && data[3].value >= 800 && [0, 10, 20, 30, 40, 50].includes(data[3].value % 100)
            && parseInt(data[2].value) < parseInt(data[3].value)
          )) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          if (data[0].value === "" || data[1].value === "" || data[2].value === "" || data[3].value === "") {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
          ids = await get_data(`SELECT ID FROM CCA`);
          if (!(ids.map(x => x[0]).includes(parseInt(data[0].value)) && ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"].includes(data[1].value))) {
            document.getElementById("edit_data_modal").getElementsByClassName("btn-primary")[0].disabled = true;
          }
        }
      }

      function edit_data() {
        var data = document.getElementById("edit_data_modal").getElementsByClassName("form-control");
        var row = Array.from(document.getElementsByClassName("search_group_table")[active_search].getElementsByClassName("table_data_row")[edit_row].children).splice(1, data.length);
        console.log(data);
        if (active_search === 0) {
            post_data(`UPDATE Student SET ID = '${data[0].value}', Name = '${data[1].value}', ClassID = ${data[2].value} WHERE ID = '${row[0].innerText}'`);
          } else if (active_search === 1) {
            post_data(`UPDATE Teacher SET ID = '${data[0].value}', Name = '${data[1].value}', ClassID = ${data[2].value} WHERE ID = '${row[0].innerText}'`);
          } else if (active_search === 2) {
            post_data(`UPDATE Class SET ID = ${data[0].value}, Name = '${data[1].value}' WHERE ID = ${row[0].innerText}`);
          } else if (active_search === 3) {
            post_data(`UPDATE Course SET ID = ${data[0].value}, Name = '${data[1].value}' WHERE ID = ${row[0].innerText}`);
          } else if (active_search === 4) {
            post_data(`UPDATE CCA SET ID = ${data[0].value}, Name = '${data[1].value}' WHERE ID = ${row[0].innerText}`);
          } else if (active_search === 5) {
            post_data(`UPDATE StudentCourse SET StudentID = '${data[0].value}', CourseID = ${data[1].value} WHERE StudentID = '${row[0].innerText}' AND CourseID = ${row[1].innerText}`);
          } else if (active_search === 6) {
            post_data(`UPDATE StudentCCA SET StudentID = '${data[0].value}', CCAID = ${data[1].value} WHERE StudentID = '${row[0].innerText}' AND CCAID = ${row[1].innerText}`);
          } else if (active_search === 7) {
            post_data(`UPDATE TeacherCourse SET TeacherID = '${data[0].value}', CourseID = ${data[1].value} WHERE TeacherID = '${row[0].innerText}' AND CourseID = ${row[1].innerText}`);
          } else if (active_search === 8) {
            post_data(`UPDATE CourseSession SET CourseID = ${data[0].value}, Day = '${data[1].value}', StartTime = '${data[2].value}', EndTime = '${data[3].value}' WHERE CourseID = ${row[0].innerText} AND Day = '${row[1].innerText}' AND StartTime = '${row[2].innerText}'`);
          } else {
            post_data(`UPDATE CCASession SET CCAID = ${data[0].value}, Day = '${data[1].value}', StartTime = '${data[2].value}', EndTime = '${data[3].value}' WHERE CCAID = ${row[0].innerText} AND Day = '${row[1].innerText}' AND StartTime = '${row[2].innerText}'`);
          }
        for (let i = 0; i < data.length; i++) {
          row[i].innerText = data[i].value;
        }
        modal.hide();
      }

      async function live_search() {
        var sibs = document.getElementsByClassName("search_group")[active_search].children;
        var table = document.getElementsByClassName("search_group_table")[active_search];
        var rows = table.getElementsByClassName("table_data_row");
        var filters = [];
        var result = [];
        var row;
        var cell;
        var checkbox;
        var img;

        while (rows.length > 0) {
          rows[0].remove();
        }

        if (active_search == 0) {
          filters.push(await get_data(`SELECT * FROM Student WHERE ID IN ('${sibs[0].value}')`));
          filters.push(await get_data(`SELECT * FROM Student WHERE Name IN ('${sibs[1].value}')`));
          filters.push(await get_data(`SELECT * FROM Student WHERE ClassID IN (${sibs[2].value})`));
          result = intersect(...filters);
          if (typeof result === 'undefined') {
            return false;
          }
          for (let i = 0; i < result.length; i++) {
            row = table.insertRow(-1);
            row.classList.add("table_data_row");
            cell = row.insertCell(-1);
            checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.className = "check_del";
            checkbox.style = "transform: scale(1.5);";
            checkbox.setAttribute("onclick", "data_del_check(event, this)");
            cell.appendChild(checkbox);
            cell.style = "text-align: center; width: 150px;"
            cell = row.insertCell(-1);
            cell.innerText = result[i][0];
            cell = row.insertCell(-1);
            cell.innerText = result[i][1];
            cell = row.insertCell(-1);
            cell.innerText = result[i][2];
            cell = row.insertCell(-1);
            img = document.createElement("img");
            img.src = "../static/img/edit.png";
            img.alt = "edit";
            img.className = "select_icon";
            img.setAttribute("onclick", "edit_data_modal(this)");
            cell.appendChild(img);
          }
        } else if (active_search == 1) {
          filters.push(await get_data(`SELECT * FROM Teacher WHERE ID IN ('${sibs[0].value}')`));
          filters.push(await get_data(`SELECT * FROM Teacher WHERE Name IN ('${sibs[1].value}')`));
          filters.push(await get_data(`SELECT * FROM Teacher WHERE ClassID IN (${sibs[2].value})`));
          result = intersect(...filters);
          if (typeof result === 'undefined') {
            return false;
          }
          for (let i = 0; i < result.length; i++) {
            row = table.insertRow(-1);
            row.classList.add("table_data_row");
            cell = row.insertCell(-1);
            checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.className = "check_del";
            checkbox.style = "transform: scale(1.5);";
            checkbox.setAttribute("onclick", "data_del_check(event, this)");
            cell.appendChild(checkbox);
            cell.style = "text-align: center; width: 150px;"
            cell = row.insertCell(-1);
            cell.innerText = result[i][0];
            cell = row.insertCell(-1);
            cell.innerText = result[i][1];
            cell = row.insertCell(-1);
            cell.innerText = result[i][2];
            cell = row.insertCell(-1);
            img = document.createElement("img");
            img.src = "../static/img/edit.png";
            img.alt = "edit";
            img.className = "select_icon";
            img.setAttribute("onclick", "edit_data_modal(this)");
            cell.appendChild(img);
          }
        } else if (active_search == 2) {
          filters.push(await get_data(`SELECT * FROM Class WHERE ID IN (${sibs[0].value})`));
          filters.push(await get_data(`SELECT * FROM Class WHERE Name IN ('${sibs[1].value}')`));
          result = intersect(...filters);
          if (typeof result === 'undefined') {
            return false;
          }
          for (let i = 0; i < result.length; i++) {
            row = table.insertRow(-1);
            row.classList.add("table_data_row");
            cell = row.insertCell(-1);
            checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.className = "check_del";
            checkbox.style = "transform: scale(1.5);";
            checkbox.setAttribute("onclick", "data_del_check(event, this)");
            cell.appendChild(checkbox);
            cell.style = "text-align: center; width: 150px;"
            cell = row.insertCell(-1);
            cell.innerText = result[i][0];
            cell = row.insertCell(-1);
            cell.innerText = result[i][1];
            cell = row.insertCell(-1);
            img = document.createElement("img");
            img.src = "../static/img/edit.png";
            img.alt = "edit";
            img.className = "select_icon";
            img.setAttribute("onclick", "edit_data_modal(this)");
            cell.appendChild(img);
          }
        } else if (active_search == 3) {
          filters.push(await get_data(`SELECT * FROM Course WHERE ID IN (${sibs[0].value})`));
          filters.push(await get_data(`SELECT * FROM Course WHERE Name IN ('${sibs[1].value}')`));
          result = intersect(...filters);
          if (typeof result === 'undefined') {
            return false;
          }
          for (let i = 0; i < result.length; i++) {
            row = table.insertRow(-1);
            row.classList.add("table_data_row");
            cell = row.insertCell(-1);
            checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.className = "check_del";
            checkbox.style = "transform: scale(1.5);";
            checkbox.setAttribute("onclick", "data_del_check(event, this)");
            cell.appendChild(checkbox);
            cell.style = "text-align: center; width: 150px;"
            cell = row.insertCell(-1);
            cell.innerText = result[i][0];
            cell = row.insertCell(-1);
            cell.innerText = result[i][1];
            cell = row.insertCell(-1);
            img = document.createElement("img");
            img.src = "../static/img/edit.png";
            img.alt = "edit";
            img.className = "select_icon";
            img.setAttribute("onclick", "edit_data_modal(this)");
            cell.appendChild(img);
          }
        } else if (active_search == 4) {
          filters.push(await get_data(`SELECT * FROM CCA WHERE ID IN (${sibs[0].value})`));
          filters.push(await get_data(`SELECT * FROM CCA WHERE Name IN ('${sibs[1].value}')`));
          result = intersect(...filters);
          if (typeof result === 'undefined') {
            return false;
          }
          for (let i = 0; i < result.length; i++) {
            row = table.insertRow(-1);
            row.classList.add("table_data_row");
            cell = row.insertCell(-1);
            checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.className = "check_del";
            checkbox.style = "transform: scale(1.5);";
            checkbox.setAttribute("onclick", "data_del_check(event, this)");
            cell.appendChild(checkbox);
            cell.style = "text-align: center; width: 150px;"
            cell = row.insertCell(-1);
            cell.innerText = result[i][0];
            cell = row.insertCell(-1);
            cell.innerText = result[i][1];
            cell = row.insertCell(-1);
            img = document.createElement("img");
            img.src = "../static/img/edit.png";
            img.alt = "edit";
            img.className = "select_icon";
            img.setAttribute("onclick", "edit_data_modal(this)");
            cell.appendChild(img);
          }
        } else if (active_search == 5) {
          filters.push(await get_data(`SELECT * FROM StudentCourse WHERE StudentID IN ('${sibs[0].value}')`));
          filters.push(await get_data(`SELECT * FROM StudentCourse WHERE CourseID IN (${sibs[1].value})`));
          result = intersect(...filters);
          if (typeof result === 'undefined') {
            return false;
          }
          for (let i = 0; i < result.length; i++) {
            row = table.insertRow(-1);
            row.classList.add("table_data_row");
            cell = row.insertCell(-1);
            checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.className = "check_del";
            checkbox.style = "transform: scale(1.5);";
            checkbox.setAttribute("onclick", "data_del_check(event, this)");
            cell.appendChild(checkbox);
            cell.style = "text-align: center; width: 150px;"
            cell = row.insertCell(-1);
            cell.innerText = result[i][0];
            cell = row.insertCell(-1);
            cell.innerText = result[i][1];
            cell = row.insertCell(-1);
            img = document.createElement("img");
            img.src = "../static/img/edit.png";
            img.alt = "edit";
            img.className = "select_icon";
            img.setAttribute("onclick", "edit_data_modal(this)");
            cell.appendChild(img);
          }
        } else if (active_search == 6) {
          filters.push(await get_data(`SELECT * FROM StudentCCA WHERE StudentID IN ('${sibs[0].value}')`));
          filters.push(await get_data(`SELECT * FROM StudentCCA WHERE CCAID IN (${sibs[1].value})`));
          result = intersect(...filters);
          if (typeof result === 'undefined') {
            return false;
          }
          for (let i = 0; i < result.length; i++) {
            row = table.insertRow(-1);
            row.classList.add("table_data_row");
            cell = row.insertCell(-1);
            checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.className = "check_del";
            checkbox.style = "transform: scale(1.5);";
            checkbox.setAttribute("onclick", "data_del_check(event, this)");
            cell.appendChild(checkbox);
            cell.style = "text-align: center; width: 150px;"
            cell = row.insertCell(-1);
            cell.innerText = result[i][0];
            cell = row.insertCell(-1);
            cell.innerText = result[i][1];
            cell = row.insertCell(-1);
            img = document.createElement("img");
            img.src = "../static/img/edit.png";
            img.alt = "edit";
            img.className = "select_icon";
            img.setAttribute("onclick", "edit_data_modal(this)");
            cell.appendChild(img);
          }
        } else if (active_search == 7) {
          filters.push(await get_data(`SELECT * FROM TeacherCourse WHERE TeacherID IN ('${sibs[0].value}')`));
          filters.push(await get_data(`SELECT * FROM TeacherCourse WHERE CourseID IN (${sibs[1].value})`));
          result = intersect(...filters);
          if (typeof result === 'undefined') {
            return false;
          }
          for (let i = 0; i < result.length; i++) {
            row = table.insertRow(-1);
            row.classList.add("table_data_row");
            cell = row.insertCell(-1);
            checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.className = "check_del";
            checkbox.style = "transform: scale(1.5);";
            checkbox.setAttribute("onclick", "data_del_check(event, this)");
            cell.appendChild(checkbox);
            cell.style = "text-align: center; width: 150px;"
            cell = row.insertCell(-1);
            cell.innerText = result[i][0];
            cell = row.insertCell(-1);
            cell.innerText = result[i][1];
            cell = row.insertCell(-1);
            img = document.createElement("img");
            img.src = "../static/img/edit.png";
            img.alt = "edit";
            img.className = "select_icon";
            img.setAttribute("onclick", "edit_data_modal(this)");
            cell.appendChild(img);
          }
        } else if (active_search == 8) {
          filters.push(await get_data(`SELECT * FROM CourseSession WHERE CourseID IN (${sibs[0].value})`));
          filters.push(await get_data(`SELECT * FROM CourseSession WHERE Day IN ('${sibs[1].value}')`));
          filters.push(await get_data(`SELECT * FROM CourseSession WHERE StartTime IN ('${sibs[2].value}')`));
          filters.push(await get_data(`SELECT * FROM CourseSession WHERE EndTime IN ('${sibs[3].value}')`));
          result = intersect(...filters);
          if (typeof result === 'undefined') {
            return false;
          }
          for (let i = 0; i < result.length; i++) {
            row = table.insertRow(-1);
            row.classList.add("table_data_row");
            cell = row.insertCell(-1);
            checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.className = "check_del";
            checkbox.style = "transform: scale(1.5);";
            checkbox.setAttribute("onclick", "data_del_check(event, this)");
            cell.appendChild(checkbox);
            cell.style = "text-align: center; width: 150px;"
            cell = row.insertCell(-1);
            cell.innerText = result[i][0];
            cell = row.insertCell(-1);
            cell.innerText = result[i][1];
            cell = row.insertCell(-1);
            cell.innerText = result[i][2];
            cell = row.insertCell(-1);
            cell.innerText = result[i][3];
            cell = row.insertCell(-1);
            img = document.createElement("img");
            img.src = "../static/img/edit.png";
            img.alt = "edit";
            img.className = "select_icon";
            img.setAttribute("onclick", "edit_data_modal(this)");
            cell.appendChild(img);
          }
        } else {
          filters.push(await get_data(`SELECT * FROM CCASession WHERE CCAID IN (${sibs[0].value})`));
          filters.push(await get_data(`SELECT * FROM CCASession WHERE Day IN ('${sibs[1].value}')`));
          filters.push(await get_data(`SELECT * FROM CCASession WHERE StartTime IN ('${sibs[2].value}')`));
          filters.push(await get_data(`SELECT * FROM CCASession WHERE EndTime IN ('${sibs[3].value}')`));
          result = intersect(...filters);
          if (typeof result === 'undefined') {
            return false;
          }
          for (let i = 0; i < result.length; i++) {
            row = table.insertRow(-1);
            row.classList.add("table_data_row");
            cell = row.insertCell(-1);
            checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.className = "check_del";
            checkbox.style = "transform: scale(1.5);";
            checkbox.setAttribute("onclick", "data_del_check(event, this)");
            cell.appendChild(checkbox);
            cell.style = "text-align: center; width: 150px;"
            cell = row.insertCell(-1);
            cell.innerText = result[i][0];
            cell = row.insertCell(-1);
            cell.innerText = result[i][1];
            cell = row.insertCell(-1);
            cell.innerText = result[i][2];
            cell = row.insertCell(-1);
            cell.innerText = result[i][3];
            cell = row.insertCell(-1);
            img = document.createElement("img");
            img.src = "../static/img/edit.png";
            img.alt = "edit";
            img.className = "select_icon";
            img.setAttribute("onclick", "edit_data_modal(this)");
            cell.appendChild(img);
          }
        }
      }

      function add_record_modal() {
        modal = new bootstrap.Modal(document.getElementById("add_record_modal"));
        modal.show();
      }

      function add_record() {
        var sibs = document.getElementById("add_data_form").children[active_add + 1].children;
        if (active_add === 0) {
          post_data(`INSERT INTO Student VALUES ('${sibs[0].value.toUpperCase()}', '${sibs[1].value}', ${sibs[2].value})`);
        } else if (active_add === 1) {
          if (sibs[2].value === "None") {
            post_data(`INSERT INTO Teacher(ID, Name) VALUES ('${sibs[0].value.toUpperCase()}', '${sibs[1].value}')`);
          } else {
            post_data(`INSERT INTO Teacher VALUES ('${sibs[0].value.toUpperCase()}', '${sibs[1].value}', ${sibs[2].value})`);
          }
        } else if (active_add === 2) {
          post_data(`INSERT INTO Class VALUES ((SELECT COUNT(ID) %2B 1 FROM Class), '${sibs[0].value}')`);
        } else if (active_add === 3) {
          post_data(`INSERT INTO Course VALUES ((SELECT COUNT(ID) %2B 1 FROM Course), '${sibs[0].value}')`);
        } else if (active_add === 4) {
          post_data(`INSERT INTO CCA VALUES ((SELECT COUNT(ID) %2B 1 FROM CCA), '${sibs[0].value}')`);
        } else if (active_add === 5) {
          post_data(`INSERT INTO StudentCourse VALUES ('${sibs[0].value}', '${sibs[1].value}')`);
        } else if (active_add === 6) {
          post_data(`INSERT INTO StudentCCA VALUES ('${sibs[0].value}', '${sibs[1].value}')`);
        } else if (active_add === 7) {
          post_data(`INSERT INTO TeacherCourse VALUES ('${sibs[0].value}', '${sibs[1].value}')`);
        } else if (active_add === 8) {
          post_data(`INSERT INTO CourseSession VALUES ('${sibs[0].value}', '${sibs[1].value}', '${(sibs[2].value < 1000 ? "0" : "") + parseInt(sibs[2].value).toString()}', '${(sibs[3].value < 1000 ? "0" : "") + parseInt(sibs[3].value).toString()}')`);
        } else {
          post_data(`INSERT INTO CCASession VALUES ('${sibs[0].value}', '${sibs[1].value}', '${(sibs[2].value < 1000 ? "0" : "") + parseInt(sibs[2].value).toString()}', '${(sibs[3].value < 1000 ? "0" : "") + parseInt(sibs[3].value).toString()}')`);
        }
        modal.hide();
      }
      
      window.onload = function() {

        var student_input_s = document.getElementById("student_name_s");
        var student_input_t = document.getElementById("student_name_t");
        var modals = ["delete_account_modal", "add_account_modal", "save_account_modal", "add_record_modal", "delete_data_modal"];
        var mod;

        for (let i = 0; i < modals.length; i++) {
          mod = document.getElementById(modals[i]);
          mod.addEventListener("hidden.bs.modal", function() {
            modal_vis = false;
          });
          mod.addEventListener("show.bs.modal", function() {
            modal_vis = true;
          });
        }

        document.onkeydown = function(e) {
          if (tab === 3) {
            if (e.keyCode === 27 && document.activeElement.tagName === "TD") {
              document.activeElement.blur();
              return false;
            }
            if (document.getElementById("account_del").style.visibility === "visible" && ["BODY", "INPUT"].includes(document.activeElement.tagName)) {
              if (e.keyCode === 27) {
                e.preventDefault();
                var rows = document.getElementById("account_table").children[0].children;
                var cell;
                document.getElementById("account_del").style.visibility = "hidden";
                for (let i = 1; i < rows.length; i++) {
                  cell = rows[i].children[0]
                  if (cell.children.length) {
                    cell.children[0].checked = false;
                  }
                }
              }
              if (e.keyCode === 8 && !modal_vis) {
                modal = new bootstrap.Modal(document.getElementById("delete_account_modal"));
                modal.show();
              }
            }
          }
        }
        
        student_input_s.oninput = function() {
          if (student_input_s.value === "") {
            student_input_s.setAttribute("list", "");
          } else {
            student_input_s.setAttribute("list", "student_list");
          }
        };

        student_input_t.oninput = function() {
          if (student_input_t.value === "") {
            student_input_t.setAttribute("list", "");
          } else {
            student_input_t.setAttribute("list", "student_list");
          }
        };
        
      }
    </script>
  </head>
  <body>
    <ul class="nav nav-tabs" role="tablist">
      <li class="nav-item" onclick="change_tab(0)">
        <a class="nav-link active" id="availability-tab" data-bs-toggle="tab" href="#availability" role="tab" aria-controls="availability" aria-selected="true">Availability</a>
      </li>
      {% if auth == 0 %}
        <li class="nav-item">
          <a class="nav-link" href="/login">Login</a>
        </li>
      {% endif %}
      {% if auth > 0 %}
        <li class="nav-item" onclick="change_tab(1)">
          <a class="nav-link" id="add-tab" data-bs-toggle="tab" href="#add" role="tab" aria-controls="add" aria-selected="false">Add</a>
        </li>
        <li class="nav-item" onclick="change_tab(2)">
          <a class="nav-link" id="search-tab" data-bs-toggle="tab" href="#search" role="tab" aria-controls="search" aria-selected="false">Search</a>
        </li>
      {% endif %}
      {% if auth == 2 %}
        <li class="nav-item" onclick="change_tab(3)">
          <a class="nav-link" id="account-tab" data-bs-toggle="tab" href="#account" role="tab" aria-controls="account" aria-selected="false">Accounts</a>
        </li>
      {% endif %}
      {% if auth > 0 %}
        <li class="nav-item" onclick="change_tab(4)">
          <a class="nav-link" id="restore-tab" data-bs-toggle="tab" href="#restore" role="tab" aria-controls="restore" aria-selected="false">Restore</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/logout">Logout</a>
        </li>
      {% endif %}
    </ul>
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="availability" role="tabpanel">
        <div style="display: inline-block; width: fit-content;">
          <input id="student_name_s" class="m-2 form-control" list="" placeholder="Enter Student Name" onclick="this.select();" style="width: 30em;" autocomplete="off">
          <input id="class_name_s" class="m-2 form-control" list="class_list" placeholder="Enter Class Name" onclick="this.select();" style="width: 30em;" autocomplete="off">
          <input id="course_name_s" class="m-2 form-control" list="course_list" placeholder="Enter Course Name" onclick="this.select();" style="width: 30em;" autocomplete="off">
          <input id="teacher_name_s" class="m-2 form-control" list="teacher_list" placeholder="Enter Teacher Name" onclick="this.select();" style="width: 30em;" autocomplete="off">
          <input id="cca_name_s" class="m-2 form-control" list="cca_list" placeholder="Enter CCA Name" onclick="this.select();" style="width: 30em;" autocomplete="off">
          <div style="font-size: 0;">
            <div style="display: inline-block; width: 50%; text-align: left;">
              <input type="submit" class="btn btn-secondary m-2" value="Add Students" onclick="add_students()">
            </div>
            <div style="display: inline-block; width: 50%; text-align: right;">
              <input type="submit" class="btn btn-secondary m-2" value="Clear Students" onclick="clear_students()">
            </div>
          </div>
        </div>
        <div style="display: inline-block; width: fit-content;">
          <input id="teacher_name_t" class="m-2 form-control" list="teacher_list" placeholder="Enter Teacher Name" onclick="this.select();" style="width: 30em;" autocomplete="off">
          <input id="class_name_t" class="m-2 form-control" list="class_list" placeholder="Enter Class Name" onclick="this.select();" style="width: 30em;" autocomplete="off">
          <input id="course_name_t" class="m-2 form-control" list="course_list" placeholder="Enter Course Name" onclick="this.select();" style="width: 30em;" autocomplete="off">
          <input id="student_name_t" class="m-2 form-control" list="" placeholder="Enter Student Name" onclick="this.select();" style="width: 30em;" autocomplete="off">
          <div style="font-size: 0;">
            <div style="display: inline-block; width: 50%; text-align: left;">
              <input type="submit" class="btn btn-secondary m-2" value="Add Teachers" onclick="add_teachers()">
            </div>
            <div style="display: inline-block; width: 50%; text-align: right;">
              <input type="submit" class="btn btn-secondary m-2" value="Clear Teachers" onclick="clear_teachers()">
            </div>
          </div>
        </div>
        <div style="display: inline-block; width: fit-content;">
          <form action="/availability" method="post">
            <div id="student_data"></div>
            <div id="teacher_data"></div>
            <input type="submit" class="btn btn-secondary m-2" style="width: 25em; vertical-align: -6px;" value="Search Availability">
          </form>
        </div>
        <br>
        <div class="availability_scroll_table">
          <table id="student_table">
            <tr class="scroll_head">
              <th>NRIC/FIN</th>
              <th>Name</th>
              <th>Class</th>
              <th></th>
            </tr>
          </table>
        </div>
        <div class="availability_scroll_table">
          <table id="teacher_table">
            <tr class="scroll_head">
              <th>NRIC/FIN</th>
              <th>Name</th>
              <th></th>
            </tr>
          </table>
        </div>
      </div>
      {% if auth > 0 %}
        <div class="tab-pane fade" id="add" role="tabpanel" aria-labelledby="add-tab">
          <div id="add_data_form">
            <select aria-label="tables" class="m-2 form-control" style="width: 30em;" onchange="check_add_table(this)">
              <option value="Student">Student</option>
              <option value="Teacher">Teacher</option>
              <option value="Class">Class</option>
              <option value="Course">Course</option>
              <option value="CCA">CCA</option>
              <option value="StudentCourse">StudentCourse</option>
              <option value="StudentCCA">StudentCCA</option>
              <option value="TeacherCourse">TeacherCourse</option>
              <option value="CourseSession">CourseSession</option>
              <option value="CCASession">CCASession</option>
            </select>
            <div class="add_group">
              <input class="m-2 form-control" placeholder="Enter Student ID" style="width: 30em;" onclick="this.select();" onchange="check_add()">
              <input class="m-2 form-control" placeholder="Enter Student Name" style="width: 30em;" onclick="this.select();" onchange="check_add()">
              <input list="class_list_id" class="m-2 form-control" placeholder="Enter Class ID" style="width: 30em;" onclick="this.select();" onchange="check_add()">
            </div>
            <div class="add_group" hidden>
              <input class="m-2 form-control" placeholder="Enter Teacher ID" style="width: 30em;" onclick="this.select();" onchange="check_add()">
              <input class="m-2 form-control" placeholder="Enter Teacher Name" style="width: 30em;" onclick="this.select();" onchange="check_add()">
              <input list="class_list_id_n" class="m-2 form-control" placeholder="Enter Class ID" style="width: 30em;" onclick="this.select();" onchange="check_add()">
            </div>
            <div class="add_group" hidden>
              <input class="m-2 form-control" placeholder="Enter Class Name" style="width: 30em;" onclick="this.select();" onchange="check_add()">
            </div>
            <div class="add_group" hidden>
              <input class="m-2 form-control" placeholder="Enter Course Name" style="width: 30em;" onclick="this.select();" onchange="check_add()">
            </div>
            <div class="add_group" hidden>
              <input class="m-2 form-control" placeholder="Enter CCA Name" style="width: 30em;" onclick="this.select();" onchange="check_add()">
            </div>
            <div class="add_group" hidden>
              <input list="student_list_id" class="m-2 form-control" placeholder="Enter Student ID" style="width: 30em;" onclick="this.select();" onchange="check_add()">
              <input list="course_list_id" class="m-2 form-control" placeholder="Enter Course ID" style="width: 30em;" onclick="this.select();" onchange="check_add()">
            </div>
            <div class="add_group" hidden>
              <input list="student_list_id" class="m-2 form-control" placeholder="Enter Student ID" style="width: 30em;" onclick="this.select();" onchange="check_add()">
              <input list="cca_list_id" class="m-2 form-control" placeholder="Enter CCA ID" style="width: 30em;" onclick="this.select();" onchange="check_add()">
            </div>
            <div class="add_group" hidden>
              <input list="teacher_list_id" class="m-2 form-control" placeholder="Enter Teacher ID" style="width: 30em;" onclick="this.select();" onchange="check_add()">
              <input list="course_list_id" class="m-2 form-control" placeholder="Enter Course ID" style="width: 30em;" onclick="this.select();" onchange="check_add()">
            </div>
            <div class="add_group" hidden>
              <input list="course_list_id" class="m-2 form-control" placeholder="Enter Course ID" style="width: 30em;" onclick="this.select();" onchange="check_add()">
              <select aria-label="days" class="m-2 form-control" style="width: 30em;" onchange="check_add()">
                <option value="Monday">Monday</option>
                <option value="Tuesday">Tuesday</option>
                <option value="Wednesday">Wednesday</option>
                <option value="Thursday">Thursday</option>
                <option value="Friday">Friday</option>
              </select>
              <input class="m-2 form-control" placeholder="Enter Start Time" style="width: 30em;" onclick="this.select();" onchange="check_add()">
              <input class="m-2 form-control" placeholder="Enter End Time" style="width: 30em;" onclick="this.select();" onchange="check_add()">
            </div>
            <div class="add_group" hidden>
              <input list="cca_list_id" class="m-2 form-control" placeholder="Enter CCA ID" style="width: 30em;" onclick="this.select();" onchange="check_add()">
              <select aria-label="days" class="m-2 form-control" style="width: 30em;" onchange="check_add()">
                <option value="Monday">Monday</option>
                <option value="Tuesday">Tuesday</option>
                <option value="Wednesday">Wednesday</option>
                <option value="Thursday">Thursday</option>
                <option value="Friday">Friday</option>
              </select>
              <input class="m-2 form-control" placeholder="Enter Time" style="width: 30em;" onclick="this.select();" onchange="check_add()">
              <input class="m-2 form-control" placeholder="Enter End Time" style="width: 30em;" onclick="this.select();" onchange="check_add()">
            </div>
            <input type="button" id="record_add" class="m-2 btn btn-primary" value="Add Record" onclick="add_record_modal()" disabled>
          </div>
        </div>
        <div class="tab-pane fade" id="search" role="tabpanel" aria-labelledby="search-tab">
          <select aria-label="tables" class="m-2 form-control" style="width: 30em;" onchange="check_search_table(this)">
            <option value="Student">Student</option>
            <option value="Teacher">Teacher</option>
            <option value="Class">Class</option>
            <option value="Course">Course</option>
            <option value="CCA">CCA</option>
            <option value="StudentCourse">StudentCourse</option>
            <option value="StudentCCA">StudentCCA</option>
            <option value="TeacherCourse">TeacherCourse</option>
            <option value="CourseSession">CourseSession</option>
            <option value="CCASession">CCASession</option>
          </select>
          <div class="search_group">
            <input list="student_list_id" class="m-2 form-control" placeholder="Enter Student ID" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <input list="student_list" class="m-2 form-control" placeholder="Enter Student Name" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <input list="class_list_id" class="m-2 form-control" placeholder="Enter Class ID" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <div class="scroll_table">
              <table class="search_group_table">
                <tr class="scroll_head">
                  <th style="text-align: center; width: 150px; padding: 1px;"><input type="button" class="data_del btn btn-danger" value="Delete" style="visibility: hidden;" onclick="delete_data_modal()"></th>
                  <th>StudentID</th>
                  <th>StudentName</th>
                  <th>ClassID</th>
                  <th></th>
                </tr>
              </table>
            </div>
          </div>
          <div class="search_group" hidden>
            <input list="teacher_list_id" class="m-2 form-control" placeholder="Enter Teacher ID" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <input list="teacher_list" class="m-2 form-control" placeholder="Enter Teacher Name" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <input list="class_list_id" class="m-2 form-control" placeholder="Enter Class ID" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <div class="scroll_table">
              <table class="search_group_table">
                <tr class="scroll_head">
                  <th style="text-align: center; width: 150px; padding: 1px;"><input type="button" class="data_del btn btn-danger" value="Delete" style="visibility: hidden;" onclick="delete_data_modal()"></th>
                  <th>TeacherID</th>
                  <th>TeacherName</th>
                  <th>ClassID</th>
                  <th></th>
                </tr>
              </table>
            </div>
          </div>
          <div class="search_group" hidden>
            <input list="class_list_id" class="m-2 form-control" placeholder="Enter Class ID" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <input list="class_list" class="m-2 form-control" placeholder="Enter Class Name" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <div class="scroll_table">
              <table class="search_group_table">
                <tr class="scroll_head">
                  <th style="text-align: center; width: 150px; padding: 1px;"><input type="button" class="data_del btn btn-danger" value="Delete" style="visibility: hidden;" onclick="delete_data_modal()"></th>
                  <th>ClassID</th>
                  <th>ClassName</th>
                  <th></th>
                </tr>
              </table>
            </div>
          </div>
          <div class="search_group" hidden>
            <input list="course_list_id" class="m-2 form-control" placeholder="Enter Course ID" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <input list="course_list" class="m-2 form-control" placeholder="Enter Course Name" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <div class="scroll_table">
              <table class="search_group_table">
                <tr class="scroll_head">
                  <th style="text-align: center; width: 150px; padding: 1px;"><input type="button" class="data_del btn btn-danger" value="Delete" style="visibility: hidden;" onclick="delete_data_modal()"></th>
                  <th>CourseID</th>
                  <th>CourseName</th>
                  <th></th>
                </tr>
              </table>
            </div>
          </div>
          <div class="search_group" hidden>
            <input list="cca_list_id" class="m-2 form-control" placeholder="Enter CCA ID" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <input list="cca_list" class="m-2 form-control" placeholder="Enter CCA Name" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <div class="scroll_table">
              <table class="search_group_table">
                <tr class="scroll_head">
                  <th style="text-align: center; width: 150px; padding: 1px;"><input type="button" class="data_del btn btn-danger" value="Delete" style="visibility: hidden;" onclick="delete_data_modal()"></th>
                  <th>CCAID</th>
                  <th>CCAName</th>
                  <th></th>
                </tr>
              </table>
            </div>
          </div>
          <div class="search_group" hidden>
            <input list="student_list_id" class="m-2 form-control" placeholder="Enter Student ID" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <input list="course_list_id" class="m-2 form-control" placeholder="Enter Course ID" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <div class="scroll_table">
              <table class="search_group_table">
                <tr class="scroll_head">
                  <th style="text-align: center; width: 150px; padding: 1px;"><input type="button" class="data_del btn btn-danger" value="Delete" style="visibility: hidden;" onclick="delete_data_modal()"></th>
                  <th>StudentID</th>
                  <th>CourseID</th>
                  <th></th>
                </tr>
              </table>
            </div>
          </div>
          <div class="search_group" hidden>
            <input list="student_list_id" class="m-2 form-control" placeholder="Enter Student ID" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <input list="cca_list_id" class="m-2 form-control" placeholder="Enter CCA ID" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <div class="scroll_table">
              <table class="search_group_table">
                <tr class="scroll_head">
                  <th style="text-align: center; width: 150px; padding: 1px;"><input type="button" class="data_del btn btn-danger" value="Delete" style="visibility: hidden;" onclick="delete_data_modal()"></th>
                  <th>StudentID</th>
                  <th>CCAID</th>
                  <th></th>
                </tr>
              </table>
            </div>
          </div>
          <div class="search_group" hidden>
            <input list="teacher_list_id" class="m-2 form-control" placeholder="Enter Teacher ID" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <input list="course_list_id" class="m-2 form-control" placeholder="Enter Course ID" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <div class="scroll_table">
              <table class="search_group_table">
                <tr class="scroll_head">
                  <th style="text-align: center; width: 150px; padding: 1px;"><input type="button" class="data_del btn btn-danger" value="Delete" style="visibility: hidden;" onclick="delete_data_modal()"></th>
                  <th>TeacherID</th>
                  <th>CourseID</th>
                  <th></th>
                </tr>
              </table>
            </div>
          </div>
          <div class="search_group" hidden>
            <input list="course_list_id" class="m-2 form-control" placeholder="Enter Course ID" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <input list="days" class="m-2 form-control" placeholder="Enter Day" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <input list="course_start_list" class="m-2 form-control" placeholder="Enter Start Time" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <input list="course_end_list" class="m-2 form-control" placeholder="Enter End Time" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <div class="scroll_table">
              <table class="search_group_table">
                <tr class="scroll_head">
                  <th style="text-align: center; width: 150px; padding: 1px;"><input type="button" class="data_del btn btn-danger" value="Delete" style="visibility: hidden;" onclick="delete_data_modal()"></th>
                  <th>CourseID</th>
                  <th>Day</th>
                  <th>StartTime</th>
                  <th>EndTime</th>
                  <th></th>
                </tr>
              </table>
            </div>
          </div>
          <div class="search_group" hidden>
            <input list="cca_list_id" class="m-2 form-control" placeholder="Enter CCA ID" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <input list="days" class="m-2 form-control" placeholder="Enter Day" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <input list="cca_start_list" class="m-2 form-control" placeholder="Enter Time" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <input list="cca_end_list" class="m-2 form-control" placeholder="Enter End Time" style="width: 30em;" onclick="this.select();" onchange="live_search()">
            <div class="scroll_table">
              <table class="search_group_table">
                <tr class="scroll_head">
                  <th style="text-align: center; width: 150px; padding: 1px;"><input type="button" class="data_del btn btn-danger" value="Delete" style="visibility: hidden;" onclick="delete_data_modal()"></th>
                  <th>CCAID</th>
                  <th>Day</th>
                  <th>StartTime</th>
                  <th>EndTime</th>
                  <th></th>
                </tr>
              </table>
            </div>
          </div>
        </div>
      {% endif %}
      {% if auth == 2 %}
        <div class="tab-pane fade" id="account" role="tabpanel" aria-labelledby="account-tab">
          <div class="scroll_table">
            <table id="account_table">
              <tr class="scroll_head">
                <th style="text-align: center; width: 150px; padding: 1px;"><input type="button" id="account_del" class="btn btn-danger" value="Delete" style="visibility: hidden;" onclick="delete_account_modal()"></th>
                <th>Username</th>
                <th>Password</th>
                <th>Authorisation</th>
                <th></th>
              </tr>
              {% for i in data_accs | sort(attribute=1) | sort(attribute=0) | sort(attribute=2, reverse=True)%}
                <tr class="table_data_row">
                  {% if i[2] == 1 %}
                    <td style="text-align: center; width: 150px;"><input type="checkbox" class="check_del" style="transform: scale(1.5);" onclick="del_checked(event, this)"></td>
                  {% else %}
                    <td width="150px"></td>
                  {% endif %}
                  <td>{{ i[0] }}</td>
                  <td>{{ i[1] }}</td>
                  <td>{{ i[2] }}</td>
                  <td><img src="../static/img/edit.png" alt="edit" class="select_icon" onclick="edit_account_modal(this)"></td>
                </tr>
              {% endfor %}
            </table>
          </div>
          <input type="button" id="account_add" class="btn btn-primary" value="Add Account" onclick="add_account_modal()">
          <input type="button" id="account_save" class="btn btn-primary" value="Save Changes" onclick="save_account_modal()">
        </div>
      {% endif %}
      {% if auth > 0 %}
        <div class="tab-pane fade center" id="restore" role="tabpanel" aria-labelledby="restore-tab">
          <input type="button" id="restore_school" class="btn btn-primary" value="Restore School" onclick="backup()">
          {% if auth == 2 %}
            <input type="button" id="restore_account" class="btn btn-primary" value="Restore Account" onclick="backup('Account')">
          {% endif %}
        </div>
      {% endif %}
    </div>
    <div class="modal" id="delete_account_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            Confirm data deletion?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-danger" onclick="delete_accounts()">Delete</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="edit_account_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <input class="form-control" value="" placeholder="Enter username" onchange="check_edit_account(this)">
            <input class="form-control" value="" placeholder="Enter password" onchange="check_edit_account(this)">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="edit_account()">Edit</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="add_account_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <input class="form-control" placeholder="Enter username" onchange="check_add_account()">
            <input class="form-control" placeholder="Enter password" onchange="check_add_account()">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="add_account(this.parentNode.previousElementSibling.children)" disabled>Add</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="save_account_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            Confirm save?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="save_accounts()">Save</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="add_record_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" id="custom_add_msg">
            Add record?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="add_record()">Add</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="delete_data_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            Confirm data deletion?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-danger" onclick="delete_data()">Delete</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="edit_data_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="edit_data()">Edit</button>
          </div>
        </div>
      </div>
    </div>
    <datalist id="student_list">
      {% for i in data_names[0]|sort(attribute=0) %}
        <option value="{{ i[0] }}"></option>
      {% endfor %}
    </datalist>
    <datalist id="teacher_list">
      {% for i in data_names[1]|sort(attribute=0) %}
        <option value="{{ i[0] }}"></option>
      {% endfor %}
    </datalist>
    <datalist id="class_list">
      {% for i in data_names[2]|sort(attribute=0) %}
        <option value="{{ i[0] }}"></option>
      {% endfor %}
    </datalist>
    <datalist id="course_list">
      {% for i in data_names[3]|sort(attribute=0) %}
        <option value="{{ i[0] }}"></option>
      {% endfor %}
    </datalist>
    <datalist id="cca_list">
      {% for i in data_names[4]|sort(attribute=0) %}
        <option value="{{ i[0] }}"></option>
      {% endfor %}
    </datalist>
    <datalist id="student_list_id">
      {% for i in data_ids[0]|sort(attribute=0) %}
        <option value="{{ i[0] }}"></option>
      {% endfor %}
    </datalist>
    <datalist id="teacher_list_id">
      {% for i in data_ids[1]|sort(attribute=0) %}
        <option value="{{ i[0] }}"></option>
      {% endfor %}
    </datalist>
    <datalist id="class_list_id">
      {% for i in data_ids[2]|sort(attribute=0) %}
        <option value="{{ i[0] }}"></option>
      {% endfor %}
    </datalist>
    <datalist id="class_list_id_n">
      {% for i in data_ids[2]|sort(attribute=0) %}
        <option value="{{ i[0] }}"></option>
      {% endfor %}
      <option value="None"></option>
    </datalist>
    <datalist id="course_list_id">
      {% for i in data_ids[3]|sort(attribute=0) %}
        <option value="{{ i[0] }}"></option>
      {% endfor %}
    </datalist>
    <datalist id="cca_list_id">
      {% for i in data_ids[4]|sort(attribute=0) %}
        <option value="{{ i[0] }}"></option>
      {% endfor %}
    </datalist>
    <datalist id="course_start_list">
      {% for i in data_times[0]|sort(attribute=0) %}
        <option value="{{ i[0] }}"></option>
      {% endfor %}
    </datalist>
    <datalist id="course_end_list">
      {% for i in data_times[1]|sort(attribute=0) %}
        <option value="{{ i[0] }}"></option>
      {% endfor %}
    </datalist>
    <datalist id="cca_start_list">
      {% for i in data_times[2]|sort(attribute=0) %}
        <option value="{{ i[0] }}"></option>
      {% endfor %}
    </datalist>
    <datalist id="cca_end_list">
      {% for i in data_times[3]|sort(attribute=0) %}
        <option value="{{ i[0] }}"></option>
      {% endfor %}
    </datalist>
    <datalist id="days">
      <option value="Monday">Monday</option>
      <option value="Tuesday">Tuesday</option>
      <option value="Wednesday">Wednesday</option>
      <option value="Thursday">Thursday</option>
      <option value="Friday">Friday</option>
    </datalist>
  </body>
</html>